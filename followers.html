<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>FakeBook - Seguidores</title>
<style>
body { margin:0; font-family: Arial, sans-serif; background:#f0f2f5; }
header { background:#1877f2; color:white; padding:10px 20px; font-size:24px; }
.container { max-width:600px; margin:20px auto; background:white; padding:20px; border-radius:10px; }
.user { display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #ccc; }
button { padding:5px 10px; border:none; border-radius:5px; cursor:pointer; }
</style>
</head>
<body>

<header>FakeBook - Seguidores / Seguindo</header>

<div class="container">
<h2>Seguidores</h2>
<div id="followers-list"></div>

<h2>Seguindo</h2>
<div id="following-list"></div>

<h2>Seguir Usuário</h2>
<input type="text" id="usernameToFollow" placeholder="Nome de usuário">
<button onclick="followUser()">Seguir</button>
</div>

<script src="https://unpkg.com/@supabase/supabase-js/umd/supabase.js"></script>
<script>
const supabaseUrl = "https://umzlriwvexvaabliriva.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVtemxyaXd2ZXh2YWFibGlyaXZhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ4NjEwMjQsImV4cCI6MjA4MDQzNzAyNH0.8miF7Z0e2sTduJhveCk-6GKzroS0CYF-PS6BZeEKpEI";
const supabase = Supabase.createClient(supabaseUrl, supabaseKey);

const user_id = localStorage.getItem('user_id');
if(!user_id){ window.location.href='login.html'; }

// Carregar seguidores e seguindo
async function loadFollowers(){
    const { data: followers } = await supabase.from('followers').select('follower_id, users(nome,username)').eq('user_id', user_id);
    const followersDiv = document.getElementById('followers-list');
    followersDiv.innerHTML='';
    followers.forEach(f=>{
        const div = document.createElement('div');
        div.className='user';
        div.innerHTML = `<span>${f.users.nome} (@${f.users.username})</span>`;
        followersDiv.appendChild(div);
    });

    const { data: following } = await supabase.from('followers').select('user_id, users(nome,username)').eq('follower_id', user_id);
    const followingDiv = document.getElementById('following-list');
    followingDiv.innerHTML='';
    following.forEach(f=>{
        const div = document.createElement('div');
        div.className='user';
        div.innerHTML = `<span>${f.users.nome} (@${f.users.username})</span>
        <button onclick="unfollow(${f.user_id})">Deixar de seguir</button>`;
        followingDiv.appendChild(div);
    });
}

// Seguir usuário
async function followUser(){
    const username = document.getElementById('usernameToFollow').value.trim();
    if(!username) return alert('Digite o nome de usuário');
    const { data, error } = await supabase.from('users').select('id').eq('username', username).single();
    if(!data) return alert('Usuário não encontrado');
    if(data.id == user_id) return alert('Não pode seguir você mesmo');
    await supabase.from('followers').insert([{user_id: data.id, follower_id: user_id}]);
    document.getElementById('usernameToFollow').value='';
    loadFollowers();
}

// Deixar de seguir
async function unfollow(id){
    await supabase.from('followers').delete().eq('user_id', id).eq('follower_id', user_id);
    loadFollowers();
}

loadFollowers();
</script>

</body>
</html>
