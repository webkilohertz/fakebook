<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>FakeBook - Login</title>
<style>
body { margin:0; font-family: Arial, sans-serif; background:#f0f2f5; display:flex; justify-content:center; align-items:center; height:100vh; }
.login-box { background:white; padding:30px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.2); width:300px; }
input { width:100%; padding:10px; margin:10px 0; border-radius:6px; border:1px solid #ccc; }
button { width:100%; padding:10px; border:none; background:#1877f2; color:white; border-radius:6px; cursor:pointer; margin-top:10px; }
p { font-size:14px; text-align:center; }
p a { color:#1877f2; text-decoration:none; }
pre { color: red; font-size: 12px; }
</style>
</head>
<body>

<div class="login-box">
<h2>Login</h2>
<input type="text" id="username" placeholder="Usu√°rio ou email">
<input type="password" id="password" placeholder="Senha">
<button onclick="login()">Entrar</button>
<p>N√£o tem conta? <a href="signup.html">Cadastre-se</a></p>
<pre id="msg"></pre>
</div>

<!-- Use a MESMA vers√£o do Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<script>
// URLs do seu projeto
const SUPABASE_URL = "https://umzlriwvexvaabliriva.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVtemxyaXd2ZXh2YWFibGlyaXZhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ4NjEwMjQsImV4cCI6MjA4MDQzNzAyNH0.8miF7Z0e2sTduJhveCk-6GKzroS0CYF-PS6BZeEKpEI";

// Inicializa o Supabase - FORMA CORRETA
let supabase;

function initSupabase() {
    try {
        console.log('Inicializando Supabase...');
        
        // Forma 1: Verificar se a biblioteca est√° carregada
        if (typeof window.supabase !== 'undefined') {
            supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            console.log('‚úÖ Supabase inicializado!');
            return true;
        }
        // Forma 2: Tentar forma alternativa
        else if (typeof Supabase !== 'undefined') {
            supabase = Supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            console.log('‚úÖ Supabase inicializado (forma alternativa)!');
            return true;
        } else {
            console.error('‚ùå Supabase n√£o encontrado');
            return false;
        }
    } catch (error) {
        console.error('Erro ao inicializar Supabase:', error);
        return false;
    }
}

async function login(){
    try {
        // Inicializa se n√£o estiver
        if (!supabase) {
            const success = initSupabase();
            if (!success) {
                document.getElementById('msg').innerText = 'Erro: Biblioteca n√£o carregada';
                return;
            }
        }

        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value.trim();
        
        if(!username || !password){ 
            document.getElementById('msg').innerText='Preencha todos os campos'; 
            return; 
        }
        
        console.log('üîç Buscando usu√°rio:', username);
        
        // Procura usu√°rio - CORRIGIDO: usar template literals corretamente
        const { data, error } = await supabase
            .from('users')
            .select('*')
            .or(`username.eq.${username},email.eq.${username}`)
            .eq('senha_hash', password)
            .limit(1);
        
        if(error){ 
            console.error('Erro na busca:', error);
            document.getElementById('msg').innerText='Erro: '+error.message; 
            return; 
        }
        
        if(!data || data.length===0){ 
            document.getElementById('msg').innerText='Usu√°rio ou senha incorretos'; 
            return; 
        }
        
        console.log('‚úÖ Login bem-sucedido:', data[0].username);
        
        // Salva dados do usu√°rio
        localStorage.setItem('user_id', data[0].id);
        localStorage.setItem('user_name', data[0].username);
        localStorage.setItem('user_email', data[0].email);
        
        // Redireciona
        window.location.href = 'index.html';
        
    } catch(err) {
        console.error('Erro inesperado:', err);
        document.getElementById('msg').innerText = 'Erro: ' + err.message;
    }
}

// Inicializa quando a p√°gina carrega
window.addEventListener('DOMContentLoaded', () => {
    console.log('P√°gina de login carregada');
    initSupabase();
    
    // Testa a conex√£o
    testConnection();
});

// Fun√ß√£o para testar conex√£o
async function testConnection() {
    if (!supabase) return;
    
    try {
        const { data, error } = await supabase
            .from('users')
            .select('count', { count: 'exact', head: true });
            
        if (error) {
            console.log('‚ö†Ô∏è Teste falhou:', error.message);
        } else {
            console.log('‚úÖ Conex√£o OK');
        }
    } catch (error) {
        console.log('‚ö†Ô∏è N√£o foi poss√≠vel testar');
    }
}

// Permite login com Enter
document.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        login();
    }
});
</script>

</body>
</html>
