<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FakeBook - Perfil</title>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body { 
    font-family: Arial, sans-serif; 
    background: #f0f2f5; 
    color: #333;
}

header { 
    background: #1877f2; 
    color: white; 
    padding: 15px 20px; 
    font-size: 24px;
    font-weight: bold;
}

nav {
    background: white; 
    padding: 10px;
    text-align: center;
}

nav a {
    margin: 0 10px;
    color: #1877f2;
    text-decoration: none;
    padding: 5px 10px;
}

nav a:hover {
    background: #f0f2f5;
    border-radius: 5px;
}

.container {
    max-width: 800px;
    margin: 20px auto;
    padding: 20px;
}

.profile-card {
    background: white;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.profile-header {
    display: flex;
    align-items: center;
    gap: 20px;
    margin-bottom: 30px;
}

.avatar {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    border: 4px solid #1877f2;
    object-fit: cover;
}

.profile-name {
    font-size: 28px;
    color: #1877f2;
    margin-bottom: 5px;
}

.profile-info {
    margin-top: 20px;
}

.info-item {
    display: flex;
    margin-bottom: 15px;
    padding: 10px 0;
    border-bottom: 1px solid #eee;
}

.info-label {
    font-weight: bold;
    width: 150px;
    color: #666;
}

.info-value {
    color: #333;
    font-size: 16px;
}

.logout-btn {
    background: #f02849;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 20px;
    font-size: 16px;
}

.login-status {
    background: #42b72a;
    color: white;
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 12px;
    position: fixed;
    top: 10px;
    right: 10px;
}

.error-msg {
    background: #ffe6e6;
    color: #d32f2f;
    padding: 15px;
    border-radius: 5px;
    margin-bottom: 20px;
    border-left: 4px solid #d32f2f;
}
</style>
</head>
<body>

<div id="login-status" class="login-status"></div>

<header>
    FakeBook - Perfil
    <nav>
        <a href="feed.html">Feed</a>
        <a href="profile.html">Perfil</a>
        <a href="friends.html">Amigos</a>
        <a href="login.html">Logout</a>
    </nav>
</header>

<div class="container">
    <div id="error-msg" class="error-msg" style="display:none;"></div>
    
    <div class="profile-card">
        <div class="profile-header">
            <div id="avatar-container">
                <!-- Avatar ser√° inserido aqui -->
            </div>
            <div>
                <h1 id="profile-name" class="profile-name">Carregando...</h1>
                <p id="profile-username">@usuario</p>
            </div>
        </div>
        
        <div class="profile-info">
            <div class="info-item">
                <div class="info-label">üìß Email:</div>
                <div class="info-value" id="profile-email">-</div>
            </div>
            
            <div class="info-item">
                <div class="info-label">üì± Telefone:</div>
                <div class="info-value" id="profile-phone">-</div>
            </div>
            
            <div class="info-item">
                <div class="info-label">üìç Cidade:</div>
                <div class="info-value" id="profile-city">-</div>
            </div>
            
            <div class="info-item">
                <div class="info-label">üë§ Sexo:</div>
                <div class="info-value" id="profile-gender">-</div>
            </div>
            
            <div class="info-item">
                <div class="info-label">üìÖ Nascimento:</div>
                <div class="info-value" id="profile-birth">-</div>
            </div>
            
            <div class="info-item">
                <div class="info-label">üíë Relacionamento:</div>
                <div class="info-value" id="profile-relationship">-</div>
            </div>
            
            <div class="info-item">
                <div class="info-label">üè† Cidade de Origem:</div>
                <div class="info-value" id="profile-origin">-</div>
            </div>
            
            <div class="info-item">
                <div class="info-label">üìù Bio:</div>
                <div class="info-value" id="profile-bio">-</div>
            </div>
            
            <div class="info-item">
                <div class="info-label">üÜî ID do Usu√°rio:</div>
                <div class="info-value" id="profile-id">-</div>
            </div>
        </div>
        
        <button class="logout-btn" onclick="logout()">Sair da Conta</button>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<script>
// Configura√ß√£o do Supabase
const SUPABASE_URL = "https://umzlriwvexvaabliriva.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVtemxyaXd2ZXh2YWFibGlyaXZhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ4NjEwMjQsImV4cCI6MjA4MDQzNzAyNH0.8miF7Z0e2sTduJhveCk-6GKzroS0CYF-PS6BZeEKpEI";

// Inicializar Supabase
let supabase;

function initSupabase() {
    try {
        supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        console.log('Supabase inicializado');
        return true;
    } catch (error) {
        console.error('Erro ao inicializar Supabase:', error);
        showError('Erro de conex√£o com o servidor');
        return false;
    }
}

// Mostrar erro
function showError(message) {
    const errorDiv = document.getElementById('error-msg');
    errorDiv.textContent = message;
    errorDiv.style.display = 'block';
}

// Verificar login
function checkLogin() {
    const user_id = localStorage.getItem('user_id');
    const user_name = localStorage.getItem('user_name');
    
    if (!user_id) {
        showError('Voc√™ n√£o est√° logado. Redirecionando para login...');
        setTimeout(() => window.location.href = 'login.html', 2000);
        return null;
    }
    
    // Mostrar status
    const statusDiv = document.getElementById('login-status');
    statusDiv.textContent = `Logado como: ${user_name || 'Usu√°rio'}`;
    
    return user_id;
}

// Carregar perfil
async function loadProfile(user_id) {
    try {
        console.log('Buscando perfil do usu√°rio ID:', user_id);
        
        const { data, error } = await supabase
            .from('users')
            .select('*')
            .eq('id', user_id)
            .single();
        
        if (error) {
            console.error('Erro ao buscar perfil:', error);
            showError(`Erro: ${error.message}`);
            return;
        }
        
        if (!data) {
            showError('Usu√°rio n√£o encontrado');
            return;
        }
        
        console.log('Dados recebidos:', data);
        
        // Preencher os dados
        document.getElementById('profile-name').textContent = 
            `${data.nome || ''} ${data.sobrenome || ''}`.trim() || data.username || 'Usu√°rio';
        
        document.getElementById('profile-username').textContent = 
            `@${data.username || 'semusuario'}`;
        
        document.getElementById('profile-email').textContent = data.email || 'N√£o informado';
        document.getElementById('profile-phone').textContent = data.telefone || 'N√£o informado';
        document.getElementById('profile-city').textContent = data.cidade || 'N√£o informado';
        document.getElementById('profile-gender').textContent = data.genero || 'N√£o informado';
        
        // Formatar data de nascimento
        if (data.aniversario) {
            const date = new Date(data.aniversario);
            document.getElementById('profile-birth').textContent = 
                date.toLocaleDateString('pt-BR');
        } else {
            document.getElementById('profile-birth').textContent = 'N√£o informado';
        }
        
        document.getElementById('profile-relationship').textContent = 
            data.relacionamento || 'N√£o informado';
        document.getElementById('profile-origin').textContent = 
            data.cidade_origem || 'N√£o informado';
        document.getElementById('profile-bio').textContent = data.bio || 'N√£o informado';
        document.getElementById('profile-id').textContent = data.id || 'N/A';
        
        // Avatar
        const avatarContainer = document.getElementById('avatar-container');
        if (data.avatar_url) {
            avatarContainer.innerHTML = `<img src="${data.avatar_url}" alt="Avatar" class="avatar">`;
        } else {
            avatarContainer.innerHTML = `
                <div class="avatar" style="background:#1877f2; color:white; display:flex; 
                      align-items:center; justify-content:center; font-size:48px;">
                    üë§
                </div>
            `;
        }
        
    } catch (err) {
        console.error('Erro inesperado:', err);
        showError(`Erro: ${err.message}`);
    }
}

// Logout
function logout() {
    localStorage.removeItem('user_id');
    localStorage.removeItem('user_name');
    localStorage.removeItem('user_email');
    window.location.href = 'login.html';
}

// Inicializar p√°gina
window.addEventListener('DOMContentLoaded', () => {
    console.log('P√°gina carregada');
    
    // Inicializar Supabase
    if (!initSupabase()) return;
    
    // Verificar login
    const user_id = checkLogin();
    if (!user_id) return;
    
    // Carregar perfil
    loadProfile(user_id);
});
</script>

</body>
</html>
