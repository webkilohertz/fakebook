<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>FakeBook - Cadastro Completo</title>
<style>
body { margin:0; font-family: Arial, sans-serif; background:#f0f2f5; display:flex; justify-content:center; align-items:center; height:100vh; }
.signup-box { background:white; padding:30px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.2); width:320px; }
input, select { width:100%; padding:10px; margin:8px 0; border-radius:6px; border:1px solid #ccc; }
button { width:100%; padding:10px; border:none; background:#1877f2; color:white; border-radius:6px; cursor:pointer; margin-top:10px; }
p { font-size:14px; text-align:center; }
p a { color:#1877f2; text-decoration:none; }
pre { font-size:12px; color:red; }
</style>
 
</head>
  
<body>
  
<div class="signup-box">
<h2>Cadastro Completo</h2>
<input type="text" id="nome" placeholder="Nome">
<input type="text" id="sobrenome" placeholder="Sobrenome">
<input type="text" id="username" placeholder="Usuário *">
<input type="email" id="email" placeholder="Email *">
<input type="text" id="telefone" placeholder="Telefone">
<input type="password" id="senha" placeholder="Senha *">
<input type="text" id="bio" placeholder="Bio">
<input type="text" id="avatar_url" placeholder="URL Avatar">
<input type="text" id="capa_url" placeholder="URL Capa">
<select id="genero">
    <option value="">Gênero</option>
    <option value="Masculino">Masculino</option>
    <option value="Feminino">Feminino</option>
    <option value="Outro">Outro</option>
</select>
<input type="date" id="aniversario" placeholder="Aniversário">
<input type="text" id="cidade" placeholder="Cidade">
<input type="text" id="cidade_origem" placeholder="Cidade de Origem">
<select id="relacionamento">
    <option value="">Relacionamento</option>
    <option value="Solteiro(a)">Solteiro(a)</option>
    <option value="Namorando">Namorando</option>
    <option value="Casado(a)">Casado(a)</option>
    <option value="Complicado">Complicado</option>
</select>
<button onclick="signup()">Cadastrar</button>
<p>Já tem conta? <a href="login.html">Login</a></p>
<pre id="msg"></pre>



<div> 
  <nav style="background:#fff;padding:10px;text-align:center;box-shadow:0 2px 4px rgba(0,0,0,0.1);">
  <a href="feed.html" style="margin:0 10px;">Feed</a>
  <a href="profile.html" style="margin:0 10px;">Perfil</a>
  <a href="friends.html" style="margin:0 10px;">Amigos</a>
  <a href="groups.html" style="margin:0 10px;">Grupos</a>
  <a href="pages.html" style="margin:0 10px;">Páginas</a>
  <a href="media.html" style="margin:0 10px;">Mídia</a>
  <a href="stories.html" style="margin:0 10px;">Stories</a>
  <a href="settings.html" style="margin:0 10px;">Configurações</a>
  <a href="login.html" style="margin:0 10px;">Logout</a>
</nav>
</div>  
</div>

<script src="https://unpkg.com/@supabase/supabase-js/umd/supabase.js"></script>
<script>
const SUPABASE_URL = "https://umzlriwvexvaabliriva.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVtemxyaXd2ZXh2YWFibGlyaXZhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ4NjEwMjQsImV4cCI6MjA4MDQzNzAyNH0.8miF7Z0e2sTduJhveCk-6GKzroS0CYF-PS6BZeEKpEI";
const supabase = Supabase.createClient( SUPABASE_URL , SUPABASE_ANON_KEY );

async function signup(){
    try {
        const nome = document.getElementById('nome').value.trim();
        const sobrenome = document.getElementById('sobrenome').value.trim();
        const username = document.getElementById('username').value.trim();
        const email = document.getElementById('email').value.trim();
        const telefone = document.getElementById('telefone').value.trim();
        const senha = document.getElementById('senha').value.trim();
        const bio = document.getElementById('bio').value.trim();
        const avatar_url = document.getElementById('avatar_url').value.trim();
        const capa_url = document.getElementById('capa_url').value.trim();
        const genero = document.getElementById('genero').value;
        const aniversario = document.getElementById('aniversario').value || null;
        const cidade = document.getElementById('cidade').value.trim();
        const cidade_origem = document.getElementById('cidade_origem').value.trim();
        const relacionamento = document.getElementById('relacionamento').value;

        if(!username || !email || !senha){
            document.getElementById('msg').innerText='Preencha os campos obrigatórios (*)';
            return;
        }

        // Verifica duplicados
        const { data: exists, error: existsError } = await supabase
            .from('users')
            .select('id')
            .or(`username.eq.${username},email.eq.${email}`)
            .limit(1);

        if(existsError){ 
            console.error(existsError); 
            document.getElementById('msg').innerText='Erro ao verificar duplicados'; 
            return; 
        }
        if(exists.length > 0){ 
            document.getElementById('msg').innerText='Usuário ou email já existe'; 
            return; 
        }

        // Inserção completa
        const { data, error } = await supabase.from('users').insert([{
            nome,
            sobrenome,
            username,
            email,
            telefone,
            senha_hash: senha,
            bio,
            avatar_url,
            capa_url,
            genero,
            aniversario,
            cidade,
            cidade_origem,
            relacionamento,
            email_verificado: false,
            telefone_verificado: false
        }]);

        if(error){ 
            console.error(error); 
            document.getElementById('msg').innerText='Erro ao cadastrar: '+error.message; 
            return; 
        }

        console.log('Cadastro realizado:', data);
        alert('Cadastro realizado com sucesso!');
        window.location.href='login.html';
    } catch(err){
        console.error('Erro inesperado:', err);
        document.getElementById('msg').innerText='Erro inesperado: '+err.message;
    }
}
</script>

</body>
</html>
